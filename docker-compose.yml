services:
  network-monitor:
    build: .
    image: network-monitor:latest
    container_name: network-monitor
    restart: unless-stopped
    ports:
      - "8080:8080" # nginx reverse proxy
      - "8081:8081" # WebSocket server
    volumes:
      - ./logs:/app/logs
      - /var/run/docker.sock:/var/run/docker.sock  # Allow container to access Docker API
    network_mode: bridge
    privileged: true # Required for ping
    cap_add:
      - NET_RAW
      - NET_ADMIN
    # Resource limits (Docker Compose v2/v3 syntax - works on Linux & Mac)
    deploy:
      resources:
        limits:
          cpus: '0.4'      # Maximum 40% of one CPU core
          memory: 192M     # Hard limit: 192MB RAM
        reservations:
          cpus: '0.2'      # Guarantee 20% CPU
          memory: 96M      # Soft limit: 96MB RAM
    # Logging limits to prevent unbounded disk usage
    logging:
      driver: "json-file"
      options:
        max-size: "1m"  # Maximum log file size before rotation
        max-file: "2"   # Keep only 2 log files (total max: 2MB)
